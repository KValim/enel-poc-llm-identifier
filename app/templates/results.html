<!DOCTYPE html>
<html>
<head>
    <title>Resultados da Validação</title>
    <meta charset="UTF-8">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="/static/css/style.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <div class="container">
        <h1 class="text-center my-4">Resultados da Validação</h1>
        
        <h2 class="section-header">Itens Validados:</h2>
        <ul class="list-group">
            {% for item, status in encontrados.items() %}
                {% if status == 'Sim' %}
                    <li class="list-group-item item-sim" id="item-{{ loop.index }}" onclick="toggleDetails({{ loop.index }})">
                        <span>{{ item }}: <i class="icon-sim">✓</i></span>
                        {% if item in caracteristicas %}
                            <span class="arrow" id="arrow-{{ loop.index }}">&#8250;</span>
                        {% else %}
                            <span class="minus">&#8211;</span>
                        {% endif %}
                    </li>
                    {% if item in caracteristicas %}
                        <div id="details-{{ loop.index }}" class="details">
                            <ul>
                                {% for caract, valor in caracteristicas[item].items() %}
                                    {% if caract != 'Quantidade Identificada' %}
                                        <li>{{ caract }}: {{ valor }}</li>
                                    {% endif %}
                                {% endfor %}
                                {% if item != 'Quantidades' and caracteristicas[item].get('Quantidade Identificada') %}
                                    <li>Quantidade Identificada: {{ caracteristicas[item]['Quantidade Identificada'] }}</li>
                                {% endif %}
                            </ul>
                        </div>
                    {% endif %}
                {% endif %}
            {% endfor %}
        </ul>
        
        <h2 class="section-header">Exceções Encontradas:</h2>
        <h3 class="subsection-header">Deveria Existir:</h3>
        <ul class="list-group mb-4">
            {% for item, status in encontrados.items() %}
                {% if status == 'Não' %}
                    <li class="list-group-item item-nao">
                        <span>{{ item }}: <i class="icon-nao">✗</i></span>
                    </li>
                {% endif %}
            {% endfor %}
        </ul>
        
        <h3 class="subsection-header">Encontrados Não Planejados:</h3>
        <ul class="list-group mb-4">
            {% for item in extras %}
                <li class="list-group-item item-nao-planejado" id="item-extra-{{ loop.index }}" onclick="toggleDetails('extra-{{ loop.index }}')">
                    <span>{{ item }}</span>
                    {% if item in caracteristicas %}
                        <span class="arrow" id="arrow-extra-{{ loop.index }}">&#8250;</span>
                    {% else %}
                        <span class="minus">&#8211;</span>
                    {% endif %}
                </li>
                {% if item in caracteristicas %}
                    <div id="details-extra-{{ loop.index }}" class="details">
                        <ul>
                            {% for caract, valor in caracteristicas[item].items() %}
                                <li>{{ caract }}: {{ valor }}</li>
                            {% endfor %}
                        </ul>
                    </div>
                {% endif %}
            {% endfor %}
        </ul>
        
        <form method="post" action="{{ url_for('results', project=project, post=post) }}">
            <div class="mb-3">
                <label for="comments" class="form-label">Comentários:</label>
                <textarea class="form-control" id="comments" name="comments" rows="3"></textarea>
            </div>
            <button type="submit" name="action" value="validate_post" class="btn btn-success">Validar Estrutura</button>
            <button type="submit" name="action" value="invalidate_post" class="btn btn-danger">Invalidar Estrutura</button>
            <button type="submit" name="action" value="remove_photo" class="btn btn-warning">Retirar Foto</button>
        </form>
        <a href="/" class="btn btn-link">Home</a>
    </div>
    <script>
        function toggleDetails(id) {
            var details = document.getElementById("details-" + id);
            var arrow = document.getElementById("arrow-" + id);
            if (details.style.display === "none") {
                details.style.display = "block";
                if (arrow) {
                    arrow.classList.add("arrow-down");
                }
            } else {
                details.style.display = "none";
                if (arrow) {
                    arrow.classList.remove("arrow-down");
                }
            }
        }
    </script>
</body>
</html>
